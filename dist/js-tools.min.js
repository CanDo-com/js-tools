/*!
 * js-tools library
 * Version 1.4.1a built 10/20/2015
 * https://github.com/CanDo-com/js-tools.git
 *
 * Copyright (c) 2015 Advertical LLC dba CanDo
 * http://cando.com
 *
 * Author Sergiy Misyura <sergiy@cando.com>
 */
var app={};
(function(b){var f=app,d=function(a){var c={},c=b.extend(!0,c,a);c._={controllerFactories:{},serviceFactories:{},transformations:[],templateWrappers:{}};c.config=b.extend({baseUrl:"",apiUrl:"api",legacy:!0,bootstrap:3,templates:"jQuery.tmpl",catchExceptions:!0},c.config);b.extend(c,{lastException:null,services:{},init:function(){var e=b("body");c.services=c.createServices(e);c.transformation("[data-controller]",function(e){c.createController(e.get(0))});c.compile(e);b(c).triggerHandler("ready")},wrap:function(e,
a){var h=c.config.catchExceptions?function(){try{return e.apply(a,arguments)}catch(h){throw"undefined"==typeof h._stored&&(h._stored=!0,c.lastException=h,b(c).trigger("error",h)),h;}}:function(){return e.apply(a,arguments)};h._wrapped=!0;return h},wrapObject:function(e){for(var a in e)e.hasOwnProperty(a)&&"function"==typeof e[a]&&"undefined"==typeof e[a]._wrapped&&(e[a]=this.wrap(e[a],e));return e},controller:function(a,c){this._.controllerFactories[a]=c},service:function(a,c){return"undefined"==
typeof c?this._.serviceFactories[a]:this._.serviceFactories[a]=c},templateWrapper:function(a,b){if(0==arguments.length)return this._.templateWrappers[c.config.templates];this._.templateWrappers[a]=b},transformation:function(a,c){this._.transformations.push({selector:a,fn:c})},get:function(a){a=b(a);return a.length?a.get(0).controller:null},compile:function(a){b.each(this._.transformations,function(g,h){var d=a.find(h.selector);a.is(h.selector)&&(d=d.add(a));d.each(function(a,e){var g=h.fn(b(e),c.services);
"undefined"!=typeof g&&null!==g&&b(e).replaceWith(g)})});return a},log:function(a){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(a)},createServices:function(a){var g={};b.each(c._.serviceFactories,function(b,d){g[b]=c.wrapObject(d(a,g))});return g},createController:function(a){var g=b(a),h=g.attr("data-controller"),d=c._.controllerFactories[h];if("undefined"!=typeof d)return h=this.createServices(g),a.controller=c.wrapObject(d(g,h)),a.controller.$=h.$,"function"==typeof a.controller.init&&
a.controller.init(),a.controller;throw'Unknown controller: "'+h+'"';},reset:function(){window.app=d(f);window.app._=c._;window.app._.controllerFactories={};window.app.init();return window.app}});c.config.legacy&&b.extend(c,{ready:function(a,g){this.log('app.ready() function is deprecated. Use application\'s "ready" event instead.');b(c).on("ready",b.proxy(a,g))}});c.wrapObject(c);return c};app=d(app);b(document).ready(function(){app.init()});Object.keys||(Object.keys=function(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&
c.push(b);return c});b.fn.outerHtml=function(){return b("<div/>").append(this).html()}})(jQuery);(function(){app.service("api",function(b,f){var d=function(a){return function(c,b,d){b=c.responseJSON;$(app).trigger("api.error",[c.status,b,c]);a.triggerError(c.status,b,c)||$(app).trigger("api.error.unhandled",[c.status,b,c])}},a=function(a){return app.config.baseUrl+app.config.apiUrl+(void 0===a?"":"/"+a)},c=function(c,b,e,k){k=k||{};b=b||{};var m=f.deferred();$.ajax(a(c),$.extend({type:e,data:b,success:m.successCallback(),error:d(m)},k));return m},e=function(a,b,d){return c(a,JSON.stringify(b),
d,{contentType:"application/json",dataType:"json"})};return{get:function(a,b){return c(a,b,"GET")},"delete":function(a){return c(a,null,"DELETE")},post:function(a,c){return e(a,c,"post")},put:function(a,c){return e(a,c,"put")},save:function(a,c,b){return c?this.put(a+"/"+c,b):this.post(a,b)},url:function(c){return a(c)}}})})(jQuery,app);(function(b,f){f.service("hash",function(d,a){var c=[],e,g,h=function(){var a=document.location.hash;0==a.indexOf("#")&&(a=a.substr(1));var c="";-1!=a.indexOf("?")&&(c=a.substr(a.indexOf("?")+1),a=a.substr(0,a.indexOf("?")));for(var b=c.split("&"),d={},e=0;e<b.length;e++){var f=b[e].split("=");d[decodeURIComponent(f[0])]=decodeURIComponent(1<f.length?f[1]:"")}b=a.split("/");g={hash:a,path:b,query:d,queryString:c}},l=function(a,c){var b=!1;"string"==typeof a?b=a==g.path[0]:a.test&&(b=a.test(g.hash));
b&&c.apply(d[0].controller,[g].concat(g.path))},k=function(){h();b.each(c,function(a,c){l(c[0],c[1])})};return b.extend(function(){e||(h(),b(window).on("hashchange",k),e=!0);b.each(arguments,function(a,b){var e=b[0],f=b[1];"string"==typeof f&&(f=d[0].controller[f]);c.push([e,f]);l(e,f)})},{EMPTY:/^$/,ALL:/.*/,build:function(a,c){a.constructor==Array&&(a=a.join("/"));var d="#"+a;if(c){var e=[];b.each(c,function(a,c){""==c?e.push(encodeURIComponent(a)):e.push(encodeURIComponent(a)+"="+encodeURIComponent(c))});
0<e.length&&(d+="?"+e.join("&"))}return d},go:function(a,c){document.location=this.build(a,c)},set:function(a,c){var d=b.extend({},g.query);d[a]=c||"";return this.build(g.path,d)},add:function(a,c){f.log("Usage of services.hash.add() is deprecated. Use services.hash() instead.");this([a,c]);return this}})})})(jQuery,app);(function(){app.service("events",function(b,f){return function(){b.get(0);var d,a;2>arguments.length?(a=arguments[0],d=b):(d=$(arguments[0]),a=arguments[1],a[""]={},$.each(a,function(c,b){if("function"==typeof b||"string"==typeof b)a[""][c]=b,delete a[c]}));$.each(a,function(a,e){if("string"==typeof e||"function"==typeof e)e={click:e};$.each(e,function(e,h){d.on(e,a,function(a){var c=$(this),d;d="string"==typeof h?b[0].controller[h]:h;var e=[].slice.call(arguments),c=$(this);e.unshift(c);a.data=f.rendering.container(c).data("data");
return d.apply(b[0].controller,e)})})})}})})(jQuery,app);(function(){app.config.legacy&&app.service("bind",function(b,f){return function(d){app.log('"bind" service is deprecated. Use "events" service instead.');$.each(d,function(a,c){if("string"==typeof c||"function"==typeof c)c={click:c};$.each(c,function(c,d){b.on(c,a,function(a){var c=$(this),e;e="string"==typeof d?b[0].controller[d]:d;var m=[].slice.call(arguments);m.unshift(f.rendering.container(c).data("data"));m.unshift(c);"undefined"!=typeof c.data("arg")&&m.unshift(c.data("arg"));return e.apply(b[0].controller,
m)})})})}})})(jQuery,app);(function(){var b=function(b){return function(){var d=b.get(0).controller||window;return app.wrapObject({_success:$.noop,_error:$.noop,_after:$.noop,success:function(a){this._success=a;return this},error:function(a){this._error=a;return this},before:function(a){a.apply(d);return this},after:function(a){this._after=a;return this},successCallback:function(){var a=this;return function(){a._after.apply(d,arguments);return a._success.apply(d,arguments)}},errorCallback:function(){var a=this;return function(){a._after.apply(d,
arguments);return a._error.apply(d,arguments)}},triggerSuccess:function(){this.successCallback().apply(null,arguments)},triggerError:function(){this.errorCallback().apply(null,arguments)}})}};app.config.legacy&&(b.create=function(f){app.log("The function service.deferred.create() is deprecated. Use service.deferred() instead.");return b(f)});app.service("deferred",b)})(jQuery,app);(function(b,f){var d={value:function(a){if(""==b.trim(a.val()))return"This field cannot be empty."},checked:function(a){if(!a.prop("checked"))return"This should be checked"},email:function(a){if(!/^[\+0-9a-zA-Z\-\.\_]+@([0-9a-zA-Z\-]+\.)+[0-9a-zA-Z]+$/.test(a.val()))return"Please enter a valid email address"},url:function(a){if(!/^https?:\/\/[^\s/$.?#].[^\s]*$/i.test(a.val()))return"Please enter a valid URL"},zip:function(a){if(!/^[0-9]{5}$/.test(a.val()))return"Please enter a valid zip code"},integer:function(a){if(!/^[0-9]+$/.test(a.val()))return"Please enter an integer value"},
decimal:function(a){if(!/^[0-9]*(\.)?[0-9]+$/.test(a.val()))return"Please enter a numeric value"}};f.service("form",function(a,c){var e=function(a,c,d){var e=a.parents(".control-group, .validation-group, .form-group");a.addClass("invalid");if(d){e.addClass("invalid");var f=e.find(".errors").html("");"string"==typeof c&&(c=[c]);b.each(c,function(a,c){f.append(b("<label/>").html(c).addClass("label").addClass("label-important label-danger"))});f.show()}},g=function(a){var c=a.parents(".control-group, .validation-group, .form-group");
a.removeClass("invalid");c.removeClass("invalid");c.find(".errors").html("")},h=function(a,c,d,e){!0!==a.triggerHandler(c,d)&&(d.splice(0,0,a),!0!==b(f).triggerHandler(c,d)&&e.apply(null,d))},l=function(a,c){if(a.is(":visible")&&!a.prop("disabled")){var d=b.Event("validation.test",{setError:function(a){this.stopImmediatePropagation();this.error=a},error:null});a.trigger(d);if(d.error)return h(a,"validation.invalid",[d.error,c],e),!1;h(a,"validation.clear",[],g)}return!0};b("body").on("validation.test",
"[data-required]",function(a){var c=b(a.target),e=c.data("required").split("|"),f=e[0],e=e.slice(1),f=d[f],g={};b.each(e,function(a,c){if(-1==c.indexOf(":"))g[c]=!0;else{var b=c.split(":");g[b[0]]=b[1]}});if(f&&(e=c.val(),"undefined"==typeof g.empty||""!=e))if("undefined"!==typeof g.min&&e.length<parseInt(optionsObj.min))a.setError("This field should have at least "+optionsObj.min+" symbols.");else if("undefined"!==typeof g.max&&e.length>parseInt(optionsObj.max))a.setError("This field should have maximum "+
optionsObj.max+" symbols.");else if(f=f(c,g))c=c.data("message"),a.setError(c||f)});c.events({"input, textarea":{focus:function(a){l(a,!1)},keyup:function(a){l(a,!1)},blur:function(a){l(a,!0)}},select:{change:function(a){l(a,!0)},focus:function(a){l(a,!1)}}});var k=function(c){var d="string"==typeof c?b(c):c||a;return{validate:function(){var a=!0;d.find("input, textarea, select").each(function(c,d){a=l(b(d),!0)&&a});a||d.find("input.invalid,select.invalid").first().focus();return a},clear:function(){d.find("input, textarea, select").each(function(a,
c){h(b(c),"validation.clear",[],g)})},display:function(){var a;2==arguments.length?(a={},a[arguments[0]]=arguments[1]):a=arguments[0];b.each(a,function(a,c){var d=b('[name="'+a+'"]');h(d,"validation.invalid",[c,!0],e)})},collect:function(a){var c={};d.find('input[type="text"], input[type="email"], input[type="password"], select, textarea, input[type="hidden"]').each(function(a,d){var e=b(d);if(e.is(":visible")&&!e.prop("disabled")||"hidden"==e.attr("type"))c[e.attr("name")]=d.value});d.find('input[type="checkbox"],input[type="radio"]').each(function(a,
d){var e=b(d),f;e.is(":visible")?f=!0:(f=e.parent(),f=f.hasClass("checkbox")||f.hasClass("radio")?f.is(":visible"):!1);f&&e.prop("checked")&&!e.prop("disabled")&&(e=e.attr("name"),e.indexOf("[]")==e.length-2&&2<e.length?(e=e.substr(0,e.length-2),"undefined"==typeof c[e]&&(c[e]=[]),c[e].push(d.value)):c[e]=d.value)});if("undefined"!=typeof a){var e={};b.each(a,function(a,b){e[b]=c[b]||""});return e}return c}}};k.addRules=function(a){b.extend(d,a)};return k})})(jQuery,app);(function(){app.service("$",function(b){var f=function(d){var a=b.find(d);b.is(d)&&(a=a.add(b));return a};f.each=function(d,a){return $.each(d,$.proxy(a,app.get(b)))};return f})})(jQuery,app);(function(b,f){f.transformation('a[href="#"]',function(b){b.attr("href","javascript:void(0);")});f.config.bootstrap&&(f.transformation('[data-toggle="tooltip"]',function(b){b.tooltip()}),2==f.config.bootstrap&&f.transformation(".btn-loading",function(b){b.button();"INPUT"==b.get(0).tagName?b.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+b.val()):b.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+b.html())}),2==f.config.bootstrap&&
f.transformation(".btn-loading-fa",function(b){b.button();"INPUT"==b.get(0).tagName?b.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+b.val()):b.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+b.html())}));f.transformation("select[data-selected]",function(b){b.val(b.data("selected"))});f.transformation('input[type="checkbox"][data-checked]',function(b){var a=b.data("checked");b.prop("checked","1"==a||"true"==a||"checked"==a)})})(jQuery,app);(function(){var b={$gravatar:function(b,d,a){d=d||80;a=a||"mm";return"https://secure.gravatar.com/avatar/"+md5(b)+"?s="+d+"&d="+a},$phone:function(b){return 10!=b.length?b:"("+b.substring(0,3)+") "+b.substring(3,6)+" - "+b.substring(6)},$date:function(b){if(!b)return"";"object"!=typeof b&&(/^[0-9]{4}-[0-9][0-9]-[0-9][0-9]/.test(b)?(b=b.split(/[- :]/),b=new Date(b[0],b[1]-1,b[2])):b=new Date(b));return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()},$money:function(b){return null==b?"":"$"+parseFloat(b).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,
"$&,")}};app.service("rendering",function(f){var d=function(a,e,d){return a.fn(e,$.extend(d,b)).data("data",e).data("filters",d).data("_renderingTemplate",a).addClass("rendered").removeAttr("data-template")},a=function(c,b,d){return a.render(c,b,d,!1)};$.extend(a,{render:function(a,b,g,h){g=g||{};var l=f[0].templates[a];if(l){var k=$();b.constructor===Array?$.each(b,function(a,c){k=k.add(d(l,c,g))}):k=k.add(d(l,b,g));0==k.length&&(k=$("<script />").attr("type","text/html"));k=app.compile(k);h?(k.insertAfter(l.placeholder.last()),
l.placeholder=$.merge(l.placeholder,k)):($(l.placeholder.get(0)).replaceWith(k),l.placeholder.remove(),l.placeholder=k);return k}},append:function(a,b,d){this.render(a,b,d,!0)},partial:function(a,e,d){a="SCRIPT"==a.prop("tagName")?a.html():a.outerHtml();a=app.templateWrapper()(a);return app.compile(a(e,$.extend(d,b)))},refresh:function(a,b){a=this.container(a);"undefined"==typeof b&&(b=a.data("data"));var f=a.data("_renderingTemplate"),h=a.data("filters"),h=d(f,b,h);f.placeholder.splice(f.placeholder.index(a.get(0)),
1,h.get(0));a.replaceWith(h);return app.compile(h)},container:function(a){return a.closest(".rendered")}});return a})})(jQuery,app);(function(b,f){var d=function(a){if(0!=a.parents("body").length){a.find("[data-template]").each(function(a,c){d(b(c))});var c=a.closest("[data-controller]").get(0);if(c){var e=a.attr("data-template"),g=b("<script />").attr("type","text/html");"undefined"==typeof c.templates&&(c.templates={});a.replaceWith(g);a="SCRIPT"==a.prop("tagName")?a.html():a.outerHtml();c.templates[e]={fn:f.templateWrapper()(a),placeholder:g}}}};f.transformation("[data-template]",d);f.transformation("img[data-src],audio[data-src],video[data-src]",
function(a){0<a.parents(".rendered").length&&a.attr("src",a.data("src"))})})(jQuery,app);(function(b,f){var d=0;f.templateWrapper("jQuery.tmpl",function(a){var c="jstools-jquery-tmpl-"+d++;b.template(c,a);return function(a,d){var f=b.tmpl(c,b.extend(a,d));b.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return f}})})(jQuery,app);(function(b,f){f.templateWrapper("Mustache",function(d){Mustache.parse(d);return function(a,c){var e={};b.each(c,function(b,c){e[b]=function(){return function(b,d){return c(d(b),a)}}});var f=b(Mustache.render(d,b.extend(a,e)));b.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return f}})})(jQuery,app);(function(b,f){f.templateWrapper("Underscore.js",function(d){var a=_.template(d);return function(c,d){var f=b(a(b.extend(c,d)));b.each(c,function(a,b){0==a.indexOf("$")&&delete c[a]});return f}})})(jQuery,app);(function(b,f){var d={inc:function(a){return a+1},equals:function(a,b,d){return a==b?d.fn(this):d.inverse(this)},every:function(a,b){"number"!==typeof a&&(b=a,a=2);return 0==(b.data.index+1)%a?b.fn(this):b.inverse(this)}};f.templateWrapper("Handlebars",function(a){var c=Handlebars.create(),e=c.compile(a),f=function(a,b){">"==a.charAt(0)?c.registerPartial(a.substr(1),b.html()):c.registerHelper(a,b)};b.each(d,f);return function(a,d){b.each(d,f);var k=b(e(a));b.each(d,function(a){c.unregisterHelper(a)});
return k}})})(jQuery,app);
