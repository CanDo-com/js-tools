/*!
 * js-tools library
 * Version 1.4 built 10/16/2015
 * https://github.com/CanDo-com/js-tools.git
 *
 * Copyright (c) 2015 Advertical LLC dba CanDo
 * http://cando.com
 *
 * Author Sergiy Misyura <sergiy@cando.com>
 */
/*!
 * js-tools library
 * Version 1.4 built 10/16/2015
 * https://github.com/CanDo-com/js-tools.git
 *
 * Copyright (c) 2015 Advertical LLC dba CanDo
 * http://cando.com
 *
 * Author Sergiy Misyura <sergiy@cando.com>
 */
/*!
 * js-tools library
 * Version 1.4 built 10/08/2015
 * https://github.com/CanDo-com/js-tools.git
 *
 * Copyright (c) 2015 Advertical LLC dba CanDo
 * http://cando.com
 *
 * Author Sergiy Misyura <sergiy@cando.com>
 */
var app={};
(function(d){app._={controllerFactories:{},serviceFactories:{},transformations:[],templateWrappers:{}};app.config=d.extend({baseUrl:"",apiUrl:"api",legacy:!0,bootstrap:3,templates:"jQuery.tmpl",catchExceptions:!0},app.config);d.extend(app,{lastException:null,services:{},wrap:function(a,c){var b=app.config.catchExceptions?function(){try{return a.apply(c,arguments)}catch(b){throw"undefined"==typeof b._stored&&(b._stored=!0,app.lastException=b,d(app).trigger("error",b)),b;}}:function(){return a.apply(c,arguments)};
b._wrapped=!0;return b},wrapObject:function(a){for(var c in a)a.hasOwnProperty(c)&&"function"==typeof a[c]&&"undefined"==typeof a[c]._wrapped&&(a[c]=this.wrap(a[c],a));return a},controller:function(a,c){this._.controllerFactories[a]=c},service:function(a,c){return"undefined"==typeof c?this._.serviceFactories[a]:this._.serviceFactories[a]=c},templateWrapper:function(a,c){if(0==arguments.length)return this._.templateWrappers[app.config.templates];this._.templateWrappers[a]=c},transformation:function(a,
c){this._.transformations.push({selector:a,fn:c})},get:function(a){a=d(a);return a.length?a.get(0).controller:null},compile:function(a){d.each(this._.transformations,function(c,b){var e=a.find(b.selector);a.is(b.selector)&&(e=e.add(a));e.each(function(a,c){var e=b.fn(d(c),app.services);"undefined"!=typeof e&&null!==e&&d(c).replaceWith(e)})});return a},log:function(a){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(a)},createServices:function(a){var c={};d.each(app._.serviceFactories,
function(b,e){c[b]=app.wrapObject(e(a,c))});return c},createController:function(a){var c=d(a),b=c.attr("data-controller"),e=app._.controllerFactories[b];if("undefined"!=typeof e)return b=this.createServices(c),a.controller=app.wrapObject(e(c,b)),a.controller.$=b.$,"function"==typeof a.controller.init&&a.controller.init(),a.controller;throw'Unknown controller: "'+b+'"';}});app.config.legacy&&d.extend(app,{ready:function(a,c){this.log('app.ready() function is deprecated. Use application\'s "ready" event instead.');
d(app).on("ready",d.proxy(a,c))}});d.fn.outerHtml=function(){return d("<div/>").append(this).html()}})(jQuery);(function(d,a){d(document).ready(function(){a.wrapObject(a);var c=d("body");a.services=a.createServices(c);a.transformation("[data-controller]",function(b){a.createController(b.get(0))});a.compile(c);d(a).triggerHandler("ready")});Object.keys||(Object.keys=function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(e);return b})})(jQuery,app);(function(){app.service("api",function(d,a){var c=function(a){return function(b,c,e){c=b.responseJSON;$(app).trigger("api.error",[b.status,c,b]);a.triggerError(b.status,c,b)||$(app).trigger("api.error.unhandled",[b.status,c,b])}},b=function(b){return app.config.baseUrl+app.config.apiUrl+(void 0===b?"":"/"+b)},e=function(e,d,f,h){h=h||{};d=d||{};var m=a.deferred();$.ajax(b(e),$.extend({type:f,data:d,success:m.successCallback(),error:c(m)},h));return m},f=function(b,a,c){return e(b,JSON.stringify(a),
c,{contentType:"application/json",dataType:"json"})};return{get:function(b,a){return e(b,a,"GET")},"delete":function(b){return e(b,null,"DELETE")},post:function(b,a){return f(b,a,"post")},put:function(b,a){return f(b,a,"put")},save:function(b,a,c){return a?this.put(b+"/"+a,c):this.post(b,c)},url:function(a){return b(a)}}})})(jQuery,app);(function(d,a){a.service("hash",function(c,b){var e=[],f,g,k=function(){var b=document.location.hash;0==b.indexOf("#")&&(b=b.substr(1));var a="";-1!=b.indexOf("?")&&(a=b.substr(b.indexOf("?")+1),b=b.substr(0,b.indexOf("?")));for(var c=a.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");d[decodeURIComponent(f[0])]=decodeURIComponent(1<f.length?f[1]:"")}c=b.split("/");g={hash:b,path:c,query:d,queryString:a}},l=function(b,a){var e=!1;"string"==typeof b?e=b==g.path[0]:b.test&&(e=b.test(g.hash));
e&&a.apply(c[0].controller,[g].concat(g.path))},h=function(){k();d.each(e,function(b,a){l(a[0],a[1])})};return d.extend(function(){f||(k(),d(window).on("hashchange",h),f=!0);d.each(arguments,function(b,a){var d=a[0],f=a[1];"string"==typeof f&&(f=c[0].controller[f]);e.push([d,f]);l(d,f)})},{EMPTY:/^$/,ALL:/.*/,build:function(b,a){b.constructor==Array&&(b=b.join("/"));var c="#"+b;if(a){var e=[];d.each(a,function(b,a){""==a?e.push(encodeURIComponent(b)):e.push(encodeURIComponent(b)+"="+encodeURIComponent(a))});
0<e.length&&(c+="?"+e.join("&"))}return c},go:function(b,a){document.location=this.build(b,a)},set:function(b,a){var c=d.extend({},g.query);c[b]=a||"";return this.build(g.path,c)},add:function(b,c){a.log("Usage of services.hash.add() is deprecated. Use services.hash() instead.");this([b,c]);return this}})})})(jQuery,app);(function(){app.service("events",function(d,a){return function(){d.get(0);var c,b;2>arguments.length?(b=arguments[0],c=d):(c=$(arguments[0]),b=arguments[1],b[""]={},$.each(b,function(a,c){if("function"==typeof c||"string"==typeof c)b[""][a]=c,delete b[a]}));$.each(b,function(b,f){if("string"==typeof f||"function"==typeof f)f={click:f};$.each(f,function(f,k){c.on(f,b,function(b){var c=$(this),e;e="string"==typeof k?d[0].controller[k]:k;var f=[].slice.call(arguments),c=$(this);f.unshift(c);b.data=a.rendering.container(c).data("data");
return e.apply(d[0].controller,f)})})})}})})(jQuery,app);(function(){app.config.legacy&&app.service("bind",function(d,a){return function(c){app.log('"bind" service is deprecated. Use "events" service instead.');$.each(c,function(b,c){if("string"==typeof c||"function"==typeof c)c={click:c};$.each(c,function(c,e){d.on(c,b,function(b){var c=$(this),f;f="string"==typeof e?d[0].controller[e]:e;var m=[].slice.call(arguments);m.unshift(a.rendering.container(c).data("data"));m.unshift(c);"undefined"!=typeof c.data("arg")&&m.unshift(c.data("arg"));return f.apply(d[0].controller,
m)})})})}})})(jQuery,app);(function(){var d=function(a){return function(){var c=a.get(0).controller||window;return app.wrapObject({_success:$.noop,_error:$.noop,_after:$.noop,success:function(b){this._success=b;return this},error:function(b){this._error=b;return this},before:function(b){b.apply(c);return this},after:function(b){this._after=b;return this},successCallback:function(){var b=this;return function(){b._after.apply(c,arguments);return b._success.apply(c,arguments)}},errorCallback:function(){var b=this;return function(){b._after.apply(c,
arguments);return b._error.apply(c,arguments)}},triggerSuccess:function(){this.successCallback().apply(null,arguments)},triggerError:function(){this.errorCallback().apply(null,arguments)}})}};app.config.legacy&&(d.create=function(a){app.log("The function service.deferred.create() is deprecated. Use service.deferred() instead.");return d(a)});app.service("deferred",d)})(jQuery,app);(function(d,a){var c={value:function(b){if(""==d.trim(b.val()))return"This field cannot be empty."},checked:function(b){if(!b.prop("checked"))return"This should be checked"},email:function(b){if(!/^[\+0-9a-zA-Z\-\.\_]+@([0-9a-zA-Z\-]+\.)+[0-9a-zA-Z]+$/.test(b.val()))return"Please enter a valid email address"},url:function(b){if(!/^https?:\/\/[^\s/$.?#].[^\s]*$/i.test(b.val()))return"Please enter a valid URL"},zip:function(b){if(!/^[0-9]{5}$/.test(b.val()))return"Please enter a valid zip code"},integer:function(b){if(!/^[0-9]+$/.test(b.val()))return"Please enter an integer value"},
decimal:function(b){if(!/^[0-9]*(\.)?[0-9]+$/.test(b.val()))return"Please enter a numeric value"}};a.service("form",function(b,e){var f=function(b,a,c){var e=b.parents(".control-group, .validation-group, .form-group");b.addClass("invalid");if(c){e.addClass("invalid");var f=e.find(".errors").html("");"string"==typeof a&&(a=[a]);d.each(a,function(b,a){f.append(d("<label/>").html(a).addClass("label").addClass("label-important label-danger"))});f.show()}},g=function(b){var a=b.parents(".control-group, .validation-group, .form-group");
b.removeClass("invalid");a.removeClass("invalid");a.find(".errors").html("")},k=function(b,c,e,f){!0!==b.triggerHandler(c,e)&&(e.splice(0,0,b),!0!==d(a).triggerHandler(c,e)&&f.apply(null,e))},l=function(b,a){if(b.is(":visible")&&!b.prop("disabled")){var c=d.Event("validation.test",{setError:function(b){this.stopImmediatePropagation();this.error=b},error:null});b.trigger(c);if(c.error)return k(b,"validation.invalid",[c.error,a],f),!1;k(b,"validation.clear",[],g)}return!0};d("body").on("validation.test",
"[data-required]",function(b){var a=d(b.target),e=a.data("required").split("|"),f=e[0],e=e.slice(1),f=c[f],g={};d.each(e,function(b,a){if(-1==a.indexOf(":"))g[a]=!0;else{var c=a.split(":");g[c[0]]=c[1]}});if(f&&(e=a.val(),"undefined"==typeof g.empty||""!=e))if("undefined"!==typeof g.min&&e.length<parseInt(optionsObj.min))b.setError("This field should have at least "+optionsObj.min+" symbols.");else if("undefined"!==typeof g.max&&e.length>parseInt(optionsObj.max))b.setError("This field should have maximum "+
optionsObj.max+" symbols.");else if(f=f(a,g))a=a.data("message"),b.setError(a||f)});e.events({"input, textarea":{focus:function(b){l(b,!1)},keyup:function(b){l(b,!1)},blur:function(b){l(b,!0)}},select:{change:function(b){l(b,!0)},focus:function(b){l(b,!1)}}});var h=function(a){var c="string"==typeof a?d(a):a||b;return{validate:function(){var b=!0;c.find("input, textarea, select").each(function(a,c){b=l(d(c),!0)&&b});b||c.find("input.invalid,select.invalid").first().focus();return b},clear:function(){c.find("input, textarea, select").each(function(b,
a){k(d(a),"validation.clear",[],g)})},display:function(){var b;2==arguments.length?(b={},b[arguments[0]]=arguments[1]):b=arguments[0];d.each(b,function(b,a){var c=d('[name="'+b+'"]');k(c,"validation.invalid",[a,!0],f)})},collect:function(b){var a={};c.find('input[type="text"], input[type="email"], input[type="password"], select, textarea, input[type="hidden"]').each(function(b,c){var e=d(c);if(e.is(":visible")&&!e.prop("disabled")||"hidden"==e.attr("type"))a[e.attr("name")]=c.value});c.find('input[type="checkbox"],input[type="radio"]').each(function(b,
c){var e=d(c),f;e.is(":visible")?f=!0:(f=e.parent(),f=f.hasClass("checkbox")||f.hasClass("radio")?f.is(":visible"):!1);f&&e.prop("checked")&&!e.prop("disabled")&&(e=e.attr("name"),e.indexOf("[]")==e.length-2&&2<e.length?(e=e.substr(0,e.length-2),"undefined"==typeof a[e]&&(a[e]=[]),a[e].push(c.value)):a[e]=c.value)});if("undefined"!=typeof b){var e={};d.each(b,function(b,c){e[c]=a[c]||""});return e}return a}}};h.addRules=function(b){d.extend(c,b)};return h})})(jQuery,app);(function(){app.service("$",function(d){var a=function(a){var b=d.find(a);d.is(a)&&(b=b.add(d));return b};a.each=function(a,b){return $.each(a,$.proxy(b,app.get(d)))};return a})})(jQuery,app);(function(d,a){a.transformation('a[href="#"]',function(a){a.attr("href","javascript:void(0);")});a.config.bootstrap&&(a.transformation('[data-toggle="tooltip"]',function(a){a.tooltip()}),2==a.config.bootstrap&&a.transformation(".btn-loading",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.val()):a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.html())}),2==a.config.bootstrap&&
a.transformation(".btn-loading-fa",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.val()):a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.html())}));a.transformation("select[data-selected]",function(a){a.val(a.data("selected"))});a.transformation('input[type="checkbox"][data-checked]',function(a){var b=a.data("checked");a.prop("checked","1"==b||"true"==b||"checked"==b)})})(jQuery,app);(function(){var d={$gravatar:function(a,c,b){c=c||80;b=b||"mm";return"https://secure.gravatar.com/avatar/"+md5(a)+"?s="+c+"&d="+b},$phone:function(a){return 10!=a.length?a:"("+a.substring(0,3)+") "+a.substring(3,6)+" - "+a.substring(6)},$date:function(a){if(!a)return"";"object"!=typeof a&&(/^[0-9]{4}-[0-9][0-9]-[0-9][0-9]/.test(a)?(a=a.split(/[- :]/),a=new Date(a[0],a[1]-1,a[2])):a=new Date(a));return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()},$money:function(a){return null==a?"":"$"+parseFloat(a).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,
"$&,")}};app.service("rendering",function(a){var c=function(b,a,c){return b.fn(a,$.extend(c,d)).data("data",a).data("filters",c).data("_renderingTemplate",b).addClass("rendered").removeAttr("data-template")},b=function(a,c,d){return b.render(a,c,d,!1)};$.extend(b,{render:function(b,d,g,k){g=g||{};var l=a[0].templates[b];if(l){var h=$();d.constructor===Array?$.each(d,function(b,a){h=h.add(c(l,a,g))}):h=h.add(c(l,d,g));0==h.length&&(h=$("<script />").attr("type","text/html"));h=app.compile(h);k?(h.insertAfter(l.placeholder.last()),
l.placeholder=$.merge(l.placeholder,h)):($(l.placeholder.get(0)).replaceWith(h),l.placeholder.remove(),l.placeholder=h);return h}},append:function(b,a,c){this.render(b,a,c,!0)},partial:function(b,a,c){b="SCRIPT"==b.prop("tagName")?b.html():b.outerHtml();b=app.templateWrapper()(b);return app.compile(b(a,$.extend(c,d)))},refresh:function(b,a){b=this.container(b);"undefined"==typeof a&&(a=b.data("data"));var d=b.data("_renderingTemplate"),k=b.data("filters"),k=c(d,a,k);d.placeholder.splice(d.placeholder.index(b.get(0)),
1,k.get(0));b.replaceWith(k);return app.compile(k)},container:function(b){return b.closest(".rendered")}});return b})})(jQuery,app);(function(d,a){var c=function(b){if(0!=b.parents("body").length){b.find("[data-template]").each(function(b,a){c(d(a))});var e=b.closest("[data-controller]").get(0);if(e){var f=b.attr("data-template"),g=d("<script />").attr("type","text/html");"undefined"==typeof e.templates&&(e.templates={});b.replaceWith(g);b="SCRIPT"==b.prop("tagName")?b.html():b.outerHtml();e.templates[f]={fn:a.templateWrapper()(b),placeholder:g}}}};a.transformation("[data-template]",c);a.transformation("img[data-src],audio[data-src],video[data-src]",
function(b){0<b.parents(".rendered").length&&b.attr("src",b.data("src"))})})(jQuery,app);(function(d,a){var c=0;a.templateWrapper("jQuery.tmpl",function(b){var a="jstools-jquery-tmpl-"+c++;d.template(a,b);return function(b,c){var k=d.tmpl(a,d.extend(b,c));d.each(b,function(a,c){0==a.indexOf("$")&&delete b[a]});return k}})})(jQuery,app);(function(d,a){a.templateWrapper("Mustache",function(a){Mustache.parse(a);return function(b,e){var f={};d.each(e,function(a,c){f[a]=function(){return function(a,e){return c(e(a),b)}}});var g=d(Mustache.render(a,d.extend(b,f)));d.each(b,function(a,c){0==a.indexOf("$")&&delete b[a]});return g}})})(jQuery,app);(function(d,a){a.templateWrapper("Underscore.js",function(a){var b=_.template(a);return function(a,c){var g=d(b(d.extend(a,c)));d.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return g}})})(jQuery,app);(function(d,a){var c={inc:function(a){return a+1},equals:function(a,c,d){return a==c?d.fn(this):d.inverse(this)},every:function(a,c){"number"!==typeof a&&(c=a,a=2);return 0==(c.data.index+1)%a?c.fn(this):c.inverse(this)}};a.templateWrapper("Handlebars",function(a){var e=Handlebars.create(),f=e.compile(a),g=function(a,b){">"==a.charAt(0)?e.registerPartial(a.substr(1),b.html()):e.registerHelper(a,b)};d.each(c,g);return function(a,b){d.each(b,g);var c=d(f(a));d.each(b,function(a){e.unregisterHelper(a)});
return c}})})(jQuery,app);
