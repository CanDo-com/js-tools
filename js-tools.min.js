/*!
 * js-tools library
 * Version 1.1.5 built 01/28/2015
 *
 * By CanDo and Sergey Misyura <sergey@cando.com>
 *
 * https://github.com/sergeymisura/js-tools
 */
var app={};
(function(c){app._={controllerFactories:{},serviceFactories:{},transformations:[],templateWrappers:{}};app.config=c.extend({baseUrl:"",apiUrl:"api",legacy:!0,bootstrap:3,templates:"jQuery.tmpl"},app.config);c.extend(app,{lastException:null,services:{},wrap:function(b,a){var d=function(){try{return b.apply(a,arguments)}catch(d){throw"undefined"==typeof d._stored&&(d._stored=!0,app.lastException=d),d;}};d._wrapped=!0;return d},wrapObject:function(b){for(var a in b)b.hasOwnProperty(a)&&"function"==typeof b[a]&&
"undefined"==typeof b[a]._wrapped&&(b[a]=this.wrap(b[a],b));return b},controller:function(b,a){this._.controllerFactories[b]=a},service:function(b,a){return"undefined"==typeof a?this._.serviceFactories[b]:this._.serviceFactories[b]=a},templateWrapper:function(b,a){if(0==arguments.length)return this._.templateWrappers[app.config.templates];this._.templateWrappers[b]=a},transformation:function(b,a){this._.transformations.push({selector:b,fn:a})},get:function(b){b=c(b);return b.length?b.get(0).controller:
null},compile:function(b){c.each(this._.transformations,function(a,d){var e=b.find(d.selector);b.is(d.selector)&&(e=e.add(b));e.each(function(a,b){var e=d.fn(c(b),app.services);"undefined"!=typeof e&&null!==e&&c(b).replaceWith(e)})});return b},log:function(b){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(b)},createServices:function(b){var a={};c.each(app._.serviceFactories,function(d,c){a[d]=app.wrapObject(c(b,a))});return a},createController:function(b){var a=c(b),d=a.attr("data-controller"),
e=app._.controllerFactories[d];if("undefined"!=typeof e)return d=this.createServices(a),b.controller=app.wrapObject(e(a,d)),b.controller.$=d.$,"function"==typeof b.controller.init&&b.controller.init(),b.controller;throw'Unknown controller: "'+d+'"';}});app.config.legacy&&c.extend(app,{ready:function(b,a){this.log('app.ready() function is deprecated. Use application\'s "ready" event instead.');c(app).on("ready",c.proxy(b,a))}});c.fn.outerHtml=function(){return c("<div/>").append(this).html()}})(jQuery);(function(c,b){b.wrapObject(b);c(document).ready(function(){var a=c("body");b.services=b.createServices(a);b.transformation("[data-controller]",function(a){b.createController(a.get(0))});b.compile(a);c(b).triggerHandler("ready")});if(b.config.legacy)c(document).on("mouseup.auto-close",function(a){c('[data-close="auto"]:visible').each(function(b,e){var f=c(e);0!==f.has(a.target).length||f.is(a.target)||f.hide()})});Object.keys||(Object.keys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);
return b})})(jQuery,app);(function(){var c=function(b){return function(a,d,c){d=a.responseJSON;$(app).trigger("api.error",[a.status,d,a]);b.triggerError(a.status,d,a)||$(app).trigger("api.error.unhandled",[a.status,d,a])}};app.service("api",function(b,a){return{get:function(b,e){"undefined"==typeof e&&(e={});var f=a.deferred();$.ajax(app.config.apiUrl+"/"+b,{data:e,success:f.successCallback(),error:c(f)});return f},post:function(b,e){"undefined"==typeof e&&(e={});var f=a.deferred();$.ajax(app.config.apiUrl+"/"+b,{type:"post",
contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:f.successCallback(),error:c(f)});return f}}})})(jQuery,app);(function(){app.service("events",function(c,b){return function(){c.get(0);var a,d;2>arguments.length?(d=arguments[0],a=c):(a=$(arguments[0]),d=arguments[1],d[""]={},$.each(d,function(b,a){if("function"==typeof a||"string"==typeof a)d[""][b]=a,delete d[b]}));$.each(d,function(d,f){if("string"==typeof f||"function"==typeof f)f={click:f};$.each(f,function(f,k){a.on(f,d,function(a){var d=$(this),e;e="string"==typeof k?c[0].controller[k]:k;var f=[].slice.call(arguments),d=$(this);f.unshift(d);a.data=b.rendering.container(d).data("data");
return e.apply(c[0].controller,f)})})})}})})(jQuery,app);(function(){app.config.legacy&&app.service("bind",function(c,b){return function(a){app.log('"bind" service is deprecated. Use "events" service instead.');$.each(a,function(a,e){if("string"==typeof e||"function"==typeof e)e={click:e};$.each(e,function(e,g){c.on(e,a,function(a){var d=$(this),e;e="string"==typeof g?c[0].controller[g]:g;var f=[].slice.call(arguments);f.unshift(b.rendering.container(d).data("data"));f.unshift(d);"undefined"!=typeof d.data("arg")&&f.unshift(d.data("arg"));return e.apply(c[0].controller,
f)})})})}})})(jQuery,app);(function(){var c=function(b){return function(){var a=b.get(0).controller||window;return app.wrapObject({_success:$.noop,_error:$.noop,_after:$.noop,success:function(a){this._success=a;return this},error:function(a){this._error=a;return this},before:function(b){b.apply(a);return this},after:function(a){this._after=a;return this},successCallback:function(){var b=this;return function(){b._after.apply(a,arguments);return b._success.apply(a,arguments)}},errorCallback:function(){var b=this;return function(){b._after.apply(a,
arguments);return b._error.apply(a,arguments)}},triggerSuccess:function(){this.successCallback().apply(null,arguments)},triggerError:function(){this.errorCallback().apply(null,arguments)}})}};app.config.legacy&&(c.create=function(b){app.log("The function service.deferred.create() is deprecated. Use service.deferred() instead.");return c(b)});app.service("deferred",c)})(jQuery,app);(function(c,b){var a={value:function(a){if(""==c.trim(a.val()))return"This field cannot be empty."},checked:function(a){if(!a.prop("checked"))return"This should be checked"},email:function(a){if(!/^[\+0-9a-zA-Z\-\.\_]+@([0-9a-zA-Z\-]+\.)+[0-9a-zA-Z]+$/.test(a.val()))return"Please enter a valid email address"},zip:function(a){if(!/^[0-9]{5}$/.test(a.val()))return"Please enter a valid zip code"},integer:function(a){if(!/^[0-9]+$/.test(a.val()))return"Please enter an integer value"},decimal:function(a){if(!/^[0-9]*(\.)?[0-9]+$/.test(a.val()))return"Please enter a numeric value"}};
b.service("form",function(d,e){var f=function(a,b,d){var e=a.parents(".control-group, .validation-group, .form-group");a.addClass("invalid");if(d){e.addClass("invalid");var f=e.find(".errors").html("");"string"==typeof b&&(b=[b]);c.each(b,function(a,b){f.append(c("<label/>").html(b).addClass("label").addClass("label-important label-danger"))});f.show()}},g=function(a){var b=a.parents(".control-group, .validation-group, .form-group");a.removeClass("invalid");b.removeClass("invalid");b.find(".errors").html("")},
k=function(a,d,e,f){!0!==a.triggerHandler(d,e)&&(e.splice(0,0,a),!0!==c(b).triggerHandler(d,e)&&f.apply(null,e))},h=function(a,b){if(a.is(":visible")&&!a.prop("disabled")){var d=c.Event("validation.test",{setError:function(a){this.stopImmediatePropagation();this.error=a},error:null});a.trigger(d);if(d.error)return k(a,"validation.invalid",[d.error,b],f),!1;k(a,"validation.clear",[],g)}return!0};c("body").on("validation.test","[data-required]",function(b){var d=c(b.target),e=d.data("required").split("|"),
f=e[0],e=e.slice(1),f=a[f],g={};c.each(e,function(a,b){if(-1==b.indexOf(":"))g[b]=!0;else{var d=b.split(":");g[d[0]]=d[1]}});if(f&&(e=d.val(),"undefined"==typeof g.empty||""!=e))if("undefined"!==typeof g.min&&e.length<parseInt(optionsObj.min))b.setError("This field should have at least "+optionsObj.min+" symbols.");else if("undefined"!==typeof g.max&&e.length>parseInt(optionsObj.max))b.setError("This field should have maximum "+optionsObj.max+" symbols.");else if(f=f(d,g))d=d.data("message"),b.setError(d||
f)});e.events({"input, textarea":{focus:function(a){h(a,!1)},keyup:function(a){h(a,!1)},blur:function(a){h(a,!0)}},select:{change:function(a){h(a,!0)},focus:function(a){h(a,!1)}}});var l=function(a){var b="string"==typeof a?c(a):a||d;return{validate:function(){var a=!0;b.find("input, textarea, select").each(function(b,d){a=h(c(d),!0)&&a});a||b.find("input.invalid,select.invalid").first().focus();return a},clear:function(){b.find("input, textarea, select").each(function(a,b){k(c(b),"validation.clear",
[],g)})},display:function(){var a;2==arguments.length?(a={},a[arguments[0]]=arguments[1]):a=arguments[0];c.each(a,function(a,b){var d=c('[name="'+a+'"]');k(d,"validation.invalid",[b,!0],f)})},collect:function(a){var d={};b.find('input[type="text"], input[type="email"], input[type="password"], select, textarea, input[type="hidden"]').each(function(a,b){var e=c(b);if(e.is(":visible")&&!e.prop("disabled")||"hidden"==e.attr("type"))d[e.attr("name")]=b.value});b.find('input[type="checkbox"],input[type="radio"]').each(function(a,
b){var e=c(b);e.is(":visible")&&e.prop("checked")&&!e.prop("disabled")&&(d[e.attr("name")]=b.value)});if("undefined"!=typeof a){var e={};c.each(a,function(a,b){e[b]=d[b]||""});return e}return d}}};l.addRules=function(b){c.extend(a,b)};return l})})(jQuery,app);(function(){app.service("$",function(c){var b=function(a){var b=c.find(a);c.is(a)&&(b=b.add(c));return b};b.each=function(a,b){return $.each(a,$.proxy(b,app.get(c)))};return b})})(jQuery,app);(function(c,b){b.transformation('a[href="#"]',function(a){a.attr("href","javascript:void(0);")});b.config.bootstrap&&(b.transformation('[data-toggle="tooltip"]',function(a){a.tooltip()}),2==b.config.bootstrap&&b.transformation(".btn-loading",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.val()):a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.html())}),2==b.config.bootstrap&&
b.transformation(".btn-loading-fa",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.val()):a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.html())}));b.transformation("select[data-selected]",function(a){a.val(a.data("selected"))});b.transformation('input[type="checkbox"][data-checked]',function(a){var b=a.data("checked");a.prop("checked","1"==b||"true"==b||"checked"==b)})})(jQuery,app);(function(){var c={$gravatar:function(b,a,d){a=a||80;d=d||"mm";return"https://secure.gravatar.com/avatar/"+md5(b)+"?s="+a+"&d="+d},$phone:function(b){return 10!=b.length?b:"("+b.substring(0,3)+") "+b.substring(3,6)+" - "+b.substring(6)},$date:function(b){"object"!=typeof b&&(/^[0-9]{4}-[0-9][0-9]-[0-9][0-9]/.test(b)?(b=b.split(/[- :]/),b=new Date(b[0],b[1]-1,b[2])):b=new Date(b));return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}};app.service("rendering",function(b){var a=function(a,b,d){return a.fn(b,
$.extend(d,c)).data("data",b).data("filters",d).data("template",a).addClass("rendered").removeAttr("data-template")},d=function(a,b,c){return d.render(a,b,c)};$.extend(d,{render:function(d,c,g){g=g||{};var k=b[0].templates[d];if(k){var h=$();c.constructor===Array?$.each(c,function(b,d){h=h.add(a(k,d,g))}):h=h.add(a(k,c,g));0==h.length&&(h=$("<script />").attr("type","text/html"));h=app.compile(h);k.placeholder.replaceWith(h);return k.placeholder=h}},refresh:function(b,d){b=this.container(b);"undefined"==
typeof d&&(d=b.data("data"));var c=b.data("template"),k=b.data("filters"),c=a(c,d,k);b.replaceWith(c);return app.compile(c)},container:function(a){return a.closest(".rendered")}});return d})})(jQuery,app);(function(c,b){b.transformation("[data-template]",function(a){if(0!=a.parents("body").length){a.find("[data-template]").each(function(a,b){templateTransformation(c(b))});var d=a.closest("[data-controller]").get(0);if(d){var e=a.attr("data-template"),f=c("<script />").attr("type","text/html");"undefined"==typeof d.templates&&(d.templates={});a.replaceWith(f);a="SCRIPT"==a.prop("tagName")?a.html():a.outerHtml();d.templates[e]={fn:b.templateWrapper()(a),placeholder:f}}}});b.transformation("img[data-src],audio[data-src],video[data-src]",
function(a){0<a.parents(".rendered").length&&a.attr("src",a.data("src"))})})(jQuery,app);(function(c,b){var a=0;b.templateWrapper("jQuery.tmpl",function(b){var e="jstools-jquery-tmpl-"+a++;c.template(e,b);return function(a,b){var d=c.tmpl(e,c.extend(a,b));c.each(a,function(b,d){0==b.indexOf("$")&&delete a[b]});return d}})})(jQuery,app);(function(c,b){b.templateWrapper("Mustache",function(a){Mustache.parse(a);return function(b,e){var f={};c.each(e,function(a,c){f[a]=function(){return function(a,e){return c(e(a),b)}}});var g=c(Mustache.render(a,c.extend(b,f)));c.each(b,function(a,c){0==a.indexOf("$")&&delete b[a]});return g}})})(jQuery,app);(function(c,b){b.templateWrapper("Underscore.js",function(a){var b=_.template(a);return function(a,f){var g=c(b(c.extend(a,f)));c.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return g}})})(jQuery,app);
