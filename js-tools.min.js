/*!
 * js-tools library
 * Version 1.1.7 built 01/28/2015
 *
 * By CanDo and Sergey Misyura <sergey@cando.com>
 *
 * https://github.com/sergeymisura/js-tools
 */
var app={};
(function(d){app._={controllerFactories:{},serviceFactories:{},transformations:[],templateWrappers:{}};app.config=d.extend({baseUrl:"",apiUrl:"api",legacy:!0,bootstrap:3,templates:"jQuery.tmpl"},app.config);d.extend(app,{lastException:null,services:{},wrap:function(a,b){var c=function(){try{return a.apply(b,arguments)}catch(c){throw"undefined"==typeof c._stored&&(c._stored=!0,app.lastException=c),c;}};c._wrapped=!0;return c},wrapObject:function(a){for(var b in a)a.hasOwnProperty(b)&&"function"==typeof a[b]&&
"undefined"==typeof a[b]._wrapped&&(a[b]=this.wrap(a[b],a));return a},controller:function(a,b){this._.controllerFactories[a]=b},service:function(a,b){return"undefined"==typeof b?this._.serviceFactories[a]:this._.serviceFactories[a]=b},templateWrapper:function(a,b){if(0==arguments.length)return this._.templateWrappers[app.config.templates];this._.templateWrappers[a]=b},transformation:function(a,b){this._.transformations.push({selector:a,fn:b})},get:function(a){a=d(a);return a.length?a.get(0).controller:
null},compile:function(a){d.each(this._.transformations,function(b,c){var e=a.find(c.selector);a.is(c.selector)&&(e=e.add(a));e.each(function(b,a){var e=c.fn(d(a),app.services);"undefined"!=typeof e&&null!==e&&d(a).replaceWith(e)})});return a},log:function(a){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(a)},createServices:function(a){var b={};d.each(app._.serviceFactories,function(c,d){b[c]=app.wrapObject(d(a,b))});return b},createController:function(a){var b=d(a),c=b.attr("data-controller"),
e=app._.controllerFactories[c];if("undefined"!=typeof e)return c=this.createServices(b),a.controller=app.wrapObject(e(b,c)),a.controller.$=c.$,"function"==typeof a.controller.init&&a.controller.init(),a.controller;throw'Unknown controller: "'+c+'"';}});app.config.legacy&&d.extend(app,{ready:function(a,b){this.log('app.ready() function is deprecated. Use application\'s "ready" event instead.');d(app).on("ready",d.proxy(a,b))}});d.fn.outerHtml=function(){return d("<div/>").append(this).html()}})(jQuery);(function(d,a){a.wrapObject(a);d(document).ready(function(){var b=d("body");a.services=a.createServices(b);a.transformation("[data-controller]",function(b){a.createController(b.get(0))});a.compile(b);d(a).triggerHandler("ready")});if(a.config.legacy)d(document).on("mouseup.auto-close",function(b){d('[data-close="auto"]:visible').each(function(a,e){var f=d(e);0!==f.has(b.target).length||f.is(b.target)||f.hide()})});Object.keys||(Object.keys=function(b){var a=[],d;for(d in b)b.hasOwnProperty(d)&&a.push(d);
return a})})(jQuery,app);(function(){var d=function(a){return function(b,c,d){c=b.responseJSON;$(app).trigger("api.error",[b.status,c,b]);a.triggerError(b.status,c,b)||$(app).trigger("api.error.unhandled",[b.status,c,b])}};app.service("api",function(a,b){return{get:function(a,e){"undefined"==typeof e&&(e={});var f=b.deferred();$.ajax(app.config.baseUrl+app.config.apiUrl+"/"+a,{data:e,success:f.successCallback(),error:d(f)});return f},post:function(a,e){"undefined"==typeof e&&(e={});var f=b.deferred();$.ajax(app.config.baseUrl+
app.config.apiUrl+"/"+a,{type:"post",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:f.successCallback(),error:d(f)});return f}}})})(jQuery,app);(function(d,a){a.service("hash",function(b,a){var e=function(a){var c=function(){var c=document.location.hash;0==c.indexOf("#")&&(c=c.substr(1));var c=c.split("/"),d=null,e;"undefined"!==typeof a[c[0]]?(d=a[c[0]],e=c.slice(1)):"undefined"!==typeof a[""]&&(d=a[""],e=c);null!=d&&("string"==typeof d?b[0].controller[d]:d).apply(b[0].controller,e)};d(window).on("hashchange",c);""!=document.location.hash&&c()};d.extend(e,{bind:e,go:function(){document.location="#"+d.makeArray(arguments).join("/")}});return e})})(jQuery,
app);(function(){app.service("events",function(d,a){return function(){d.get(0);var b,c;2>arguments.length?(c=arguments[0],b=d):(b=$(arguments[0]),c=arguments[1],c[""]={},$.each(c,function(a,b){if("function"==typeof b||"string"==typeof b)c[""][a]=b,delete c[a]}));$.each(c,function(c,f){if("string"==typeof f||"function"==typeof f)f={click:f};$.each(f,function(f,g){b.on(f,c,function(b){var c=$(this),e;e="string"==typeof g?d[0].controller[g]:g;var f=[].slice.call(arguments),c=$(this);f.unshift(c);b.data=a.rendering.container(c).data("data");
return e.apply(d[0].controller,f)})})})}})})(jQuery,app);(function(){app.config.legacy&&app.service("bind",function(d,a){return function(b){app.log('"bind" service is deprecated. Use "events" service instead.');$.each(b,function(b,e){if("string"==typeof e||"function"==typeof e)e={click:e};$.each(e,function(e,k){d.on(e,b,function(b){var c=$(this),e;e="string"==typeof k?d[0].controller[k]:k;var f=[].slice.call(arguments);f.unshift(a.rendering.container(c).data("data"));f.unshift(c);"undefined"!=typeof c.data("arg")&&f.unshift(c.data("arg"));return e.apply(d[0].controller,
f)})})})}})})(jQuery,app);(function(){var d=function(a){return function(){var b=a.get(0).controller||window;return app.wrapObject({_success:$.noop,_error:$.noop,_after:$.noop,success:function(b){this._success=b;return this},error:function(b){this._error=b;return this},before:function(a){a.apply(b);return this},after:function(b){this._after=b;return this},successCallback:function(){var a=this;return function(){a._after.apply(b,arguments);return a._success.apply(b,arguments)}},errorCallback:function(){var a=this;return function(){a._after.apply(b,
arguments);return a._error.apply(b,arguments)}},triggerSuccess:function(){this.successCallback().apply(null,arguments)},triggerError:function(){this.errorCallback().apply(null,arguments)}})}};app.config.legacy&&(d.create=function(a){app.log("The function service.deferred.create() is deprecated. Use service.deferred() instead.");return d(a)});app.service("deferred",d)})(jQuery,app);(function(d,a){var b={value:function(a){if(""==d.trim(a.val()))return"This field cannot be empty."},checked:function(a){if(!a.prop("checked"))return"This should be checked"},email:function(a){if(!/^[\+0-9a-zA-Z\-\.\_]+@([0-9a-zA-Z\-]+\.)+[0-9a-zA-Z]+$/.test(a.val()))return"Please enter a valid email address"},zip:function(a){if(!/^[0-9]{5}$/.test(a.val()))return"Please enter a valid zip code"},integer:function(a){if(!/^[0-9]+$/.test(a.val()))return"Please enter an integer value"},decimal:function(a){if(!/^[0-9]*(\.)?[0-9]+$/.test(a.val()))return"Please enter a numeric value"}};
a.service("form",function(c,e){var f=function(a,b,c){var e=a.parents(".control-group, .validation-group, .form-group");a.addClass("invalid");if(c){e.addClass("invalid");var f=e.find(".errors").html("");"string"==typeof b&&(b=[b]);d.each(b,function(a,b){f.append(d("<label/>").html(b).addClass("label").addClass("label-important label-danger"))});f.show()}},k=function(a){var b=a.parents(".control-group, .validation-group, .form-group");a.removeClass("invalid");b.removeClass("invalid");b.find(".errors").html("")},
g=function(b,c,e,f){!0!==b.triggerHandler(c,e)&&(e.splice(0,0,b),!0!==d(a).triggerHandler(c,e)&&f.apply(null,e))},h=function(a,b){if(a.is(":visible")&&!a.prop("disabled")){var c=d.Event("validation.test",{setError:function(a){this.stopImmediatePropagation();this.error=a},error:null});a.trigger(c);if(c.error)return g(a,"validation.invalid",[c.error,b],f),!1;g(a,"validation.clear",[],k)}return!0};d("body").on("validation.test","[data-required]",function(a){var c=d(a.target),e=c.data("required").split("|"),
f=e[0],e=e.slice(1),f=b[f],g={};d.each(e,function(a,b){if(-1==b.indexOf(":"))g[b]=!0;else{var c=b.split(":");g[c[0]]=c[1]}});if(f&&(e=c.val(),"undefined"==typeof g.empty||""!=e))if("undefined"!==typeof g.min&&e.length<parseInt(optionsObj.min))a.setError("This field should have at least "+optionsObj.min+" symbols.");else if("undefined"!==typeof g.max&&e.length>parseInt(optionsObj.max))a.setError("This field should have maximum "+optionsObj.max+" symbols.");else if(f=f(c,g))c=c.data("message"),a.setError(c||
f)});e.events({"input, textarea":{focus:function(a){h(a,!1)},keyup:function(a){h(a,!1)},blur:function(a){h(a,!0)}},select:{change:function(a){h(a,!0)},focus:function(a){h(a,!1)}}});var l=function(a){var b="string"==typeof a?d(a):a||c;return{validate:function(){var a=!0;b.find("input, textarea, select").each(function(b,c){a=h(d(c),!0)&&a});a||b.find("input.invalid,select.invalid").first().focus();return a},clear:function(){b.find("input, textarea, select").each(function(a,b){g(d(b),"validation.clear",
[],k)})},display:function(){var a;2==arguments.length?(a={},a[arguments[0]]=arguments[1]):a=arguments[0];d.each(a,function(a,b){var c=d('[name="'+a+'"]');g(c,"validation.invalid",[b,!0],f)})},collect:function(a){var c={};b.find('input[type="text"], input[type="email"], input[type="password"], select, textarea, input[type="hidden"]').each(function(a,b){var e=d(b);if(e.is(":visible")&&!e.prop("disabled")||"hidden"==e.attr("type"))c[e.attr("name")]=b.value});b.find('input[type="checkbox"],input[type="radio"]').each(function(a,
b){var e=d(b);e.is(":visible")&&e.prop("checked")&&!e.prop("disabled")&&(c[e.attr("name")]=b.value)});if("undefined"!=typeof a){var e={};d.each(a,function(a,b){e[b]=c[b]||""});return e}return c}}};l.addRules=function(a){d.extend(b,a)};return l})})(jQuery,app);(function(){app.service("$",function(d){var a=function(a){var c=d.find(a);d.is(a)&&(c=c.add(d));return c};a.each=function(a,c){return $.each(a,$.proxy(c,app.get(d)))};return a})})(jQuery,app);(function(d,a){a.transformation('a[href="#"]',function(a){a.attr("href","javascript:void(0);")});a.config.bootstrap&&(a.transformation('[data-toggle="tooltip"]',function(a){a.tooltip()}),2==a.config.bootstrap&&a.transformation(".btn-loading",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.val()):a.data("loading-text",'<i class="icon-refresh icon-spin icon-large icon-white"></i> '+a.html())}),2==a.config.bootstrap&&
a.transformation(".btn-loading-fa",function(a){a.button();"INPUT"==a.get(0).tagName?a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.val()):a.data("loading-text",'<i class="fa fa-spinner fa-spin"></i> '+a.html())}));a.transformation("select[data-selected]",function(a){a.val(a.data("selected"))});a.transformation('input[type="checkbox"][data-checked]',function(a){var c=a.data("checked");a.prop("checked","1"==c||"true"==c||"checked"==c)})})(jQuery,app);(function(){var d={$gravatar:function(a,b,c){b=b||80;c=c||"mm";return"https://secure.gravatar.com/avatar/"+md5(a)+"?s="+b+"&d="+c},$phone:function(a){return 10!=a.length?a:"("+a.substring(0,3)+") "+a.substring(3,6)+" - "+a.substring(6)},$date:function(a){"object"!=typeof a&&(/^[0-9]{4}-[0-9][0-9]-[0-9][0-9]/.test(a)?(a=a.split(/[- :]/),a=new Date(a[0],a[1]-1,a[2])):a=new Date(a));return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}};app.service("rendering",function(a){var b=function(a,b,c){return a.fn(b,
$.extend(c,d)).data("data",b).data("filters",c).data("template",a).addClass("rendered").removeAttr("data-template")},c=function(a,b,d){return c.render(a,b,d)};$.extend(c,{render:function(c,d,k){k=k||{};var g=a[0].templates[c];if(g){var h=$();d.constructor===Array?$.each(d,function(a,c){h=h.add(b(g,c,k))}):h=h.add(b(g,d,k));0==h.length&&(h=$("<script />").attr("type","text/html"));h=app.compile(h);$(g.placeholder.get(0)).replaceWith(h);g.placeholder.remove();return g.placeholder=h}},refresh:function(a,
c){a=this.container(a);"undefined"==typeof c&&(c=a.data("data"));var d=a.data("template"),g=a.data("filters"),d=b(d,c,g);a.replaceWith(d);return app.compile(d)},container:function(a){return a.closest(".rendered")}});return c})})(jQuery,app);(function(d,a){a.transformation("[data-template]",function(b){if(0!=b.parents("body").length){b.find("[data-template]").each(function(a,b){templateTransformation(d(b))});var c=b.closest("[data-controller]").get(0);if(c){var e=b.attr("data-template"),f=d("<script />").attr("type","text/html");"undefined"==typeof c.templates&&(c.templates={});b.replaceWith(f);b="SCRIPT"==b.prop("tagName")?b.html():b.outerHtml();c.templates[e]={fn:a.templateWrapper()(b),placeholder:f}}}});a.transformation("img[data-src],audio[data-src],video[data-src]",
function(a){0<a.parents(".rendered").length&&a.attr("src",a.data("src"))})})(jQuery,app);(function(d,a){var b=0;a.templateWrapper("jQuery.tmpl",function(a){var e="jstools-jquery-tmpl-"+b++;d.template(e,a);return function(a,b){var c=d.tmpl(e,d.extend(a,b));d.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return c}})})(jQuery,app);(function(d,a){a.templateWrapper("Mustache",function(a){Mustache.parse(a);return function(c,e){var f={};d.each(e,function(a,b){f[a]=function(){return function(a,d){return b(d(a),c)}}});var k=d(Mustache.render(a,d.extend(c,f)));d.each(c,function(a,b){0==a.indexOf("$")&&delete c[a]});return k}})})(jQuery,app);(function(d,a){a.templateWrapper("Underscore.js",function(a){var c=_.template(a);return function(a,b){var k=d(c(d.extend(a,b)));d.each(a,function(b,c){0==b.indexOf("$")&&delete a[b]});return k}})})(jQuery,app);
